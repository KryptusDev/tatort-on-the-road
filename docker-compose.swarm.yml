version: '3.8'

services:
  tatort-app:
    image: tatort-on-the-road:latest
    # Override the default command (which processes a single file) to run the scheduler
    command: ["python", "-m", "app.scheduler"]
    deploy:
      replicas: 1
      restart_policy:
        condition: on-failure
      placement:
        constraints:
          - node.role == manager
    volumes:
      # CRITICAL FIX: The app runs in /app, so we must mount volumes there.
      # NOT /apps/tatort-on-the-road/output
      - tatort_output:/app/output
      - tatort_downloads:/app/downloads
    environment:
      - PYTHONUNBUFFERED=1
      # Create these variables in Portainer or load from .env
      # - TWITTER_API_KEY=...
      # - TWITTER_API_SECRET=...
      # - TWITTER_ACCESS_TOKEN=...
      # - TWITTER_ACCESS_SECRET=...
      # - MASTODON_ACCESS_TOKEN=...
      # - MASTODON_API_BASE_URL=...
      # - TELEGRAM_BOT_TOKEN=...
      # - TELEGRAM_CHAT_ID=...
      
volumes:
  tatort_output:
  tatort_downloads:
